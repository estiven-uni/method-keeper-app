<div class="relative">
  <button mat-icon-button (click)="cancelar()" class="absolute top-0 right-0 z-10 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
    <mat-icon>close</mat-icon>
  </button>
  <h2 mat-dialog-title class="flex items-center gap-2 text-2xl font-bold text-gray-900 dark:text-gray-100 pr-12">
    <mat-icon class="text-indigo-600 dark:text-indigo-400">settings</mat-icon>
    Configuraci√≥n
  </h2>
</div>

<mat-dialog-content class="mat-typography">
  <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
    Configura tus preferencias de la aplicaci√≥n
  </p>

  <!-- API Key de Deepseek -->
  <div class="mb-6">
    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2">
      <mat-icon class="text-purple-600 dark:text-purple-400">smart_toy</mat-icon>
      API Key de Deepseek
    </h3>
    <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">
      üí° Ingresa tu API Key de Deepseek para usar la funci√≥n de generaci√≥n con IA.
      Puedes obtener una en <a href="https://platform.deepseek.com/" target="_blank" class="text-indigo-600 dark:text-indigo-400 hover:underline">platform.deepseek.com</a>
    </p>

    <mat-form-field class="w-full" appearance="fill" subscriptSizing="dynamic">
      <mat-label>API Key de Deepseek</mat-label>
      <input 
        matInput 
        [(ngModel)]="apiKey"
        type="text"
        name="apiKey">
      <mat-icon matPrefix class="mr-2">vpn_key</mat-icon>
      <button 
        mat-icon-button 
        matSuffix 
        type="button"
        (click)="pegarDelPortapapeles('apiKey')"
        matTooltip="Pegar API Key">
        <mat-icon>content_paste</mat-icon>
      </button>
    </mat-form-field>
  </div>

  <mat-divider class="mb-6"></mat-divider>

  <!-- Sincronizaci√≥n con JSONBin -->
  <div class="mb-6">
    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2">
      <mat-icon class="text-blue-600 dark:text-blue-400">cloud_sync</mat-icon>
      Sincronizaci√≥n en la Nube
    </h3>
    <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">
      üí° Conecta tu cuenta de <a href="https://jsonbin.io/" target="_blank" class="text-indigo-600 dark:text-indigo-400 hover:underline">JSONBin.io</a> para sincronizar tus m√©todos en la nube.
      <br>
      <strong>Plan Gratuito:</strong> 100,000 requests/mes
    </p>

    <!-- API Key de JSONBin -->
    <mat-form-field class="w-full mb-3" appearance="fill" subscriptSizing="dynamic">
      <mat-label>API Key de JSONBin</mat-label>
      <input 
        matInput 
        [(ngModel)]="jsonbinApiKey"
        type="text"
        name="jsonbinApiKey">
      <mat-icon matPrefix class="mr-2">cloud</mat-icon>
      <button 
        mat-icon-button 
        matSuffix 
        type="button"
        (click)="pegarDelPortapapeles('jsonbinApiKey')"
        matTooltip="Pegar API Key">
        <mat-icon>content_paste</mat-icon>
      </button>
    </mat-form-field>

    <!-- Bin ID -->
    <mat-form-field class="w-full mb-4" appearance="fill" subscriptSizing="dynamic">
      <mat-label>Bin ID (opcional)</mat-label>
      <input 
        matInput 
        [(ngModel)]="jsonbinBinId"
        name="jsonbinBinId"
        matTooltip="Se generar√° autom√°ticamente al subir por primera vez">
      <mat-icon matPrefix class="mr-2">tag</mat-icon>
      <button 
        mat-icon-button 
        matSuffix 
        type="button"
        (click)="pegarDelPortapapeles('jsonbinBinId')"
        matTooltip="Pegar Bin ID">
        <mat-icon>content_paste</mat-icon>
      </button>
    </mat-form-field>

    <!-- Modo Desarrollo -->
    @if (jsonbinApiKey) {
      <div class="bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg border border-amber-200 dark:border-amber-800">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-3">
            <mat-icon class="text-amber-600 dark:text-amber-400">code</mat-icon>
            <div>
              <h4 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
                Modo Desarrollo
              </h4>
              <p class="text-xs text-gray-600 dark:text-gray-400">
                @if (modoDesarrollo) {
                  Sincronizaci√≥n manual solamente
                } @else {
                  Sincronizaci√≥n autom√°tica en cada cambio
                }
              </p>
            </div>
          </div>
          <mat-slide-toggle 
            [(ngModel)]="modoDesarrollo"
            color="warn"
            name="modoDesarrollo"
            (ngModelChange)="cambiarModoDesarrollo($event)">
          </mat-slide-toggle>
        </div>
        
        <!-- Explicaci√≥n seg√∫n el estado -->
        @if (modoDesarrollo) {
          <div class="bg-white dark:bg-gray-800/50 p-3 rounded border border-amber-300 dark:border-amber-700/50">
            <p class="text-xs text-gray-700 dark:text-gray-300 leading-relaxed">
              <strong>‚úã Modo Desarrollo ACTIVADO:</strong> Los cambios que hagas NO se subir√°n autom√°ticamente a la nube. Tendr√°s que hacer clic en el bot√≥n <strong>"Sincronizar Ahora"</strong> para subir tus datos manualmente. Ideal para hacer cambios sin afectar la nube inmediatamente.
            </p>
          </div>
        } @else {
          <div class="bg-white dark:bg-gray-800/50 p-3 rounded border border-green-300 dark:border-green-700/50">
            <p class="text-xs text-gray-700 dark:text-gray-300 leading-relaxed">
              <strong>üöÄ Modo Desarrollo DESACTIVADO:</strong> Todos los cambios que hagas (crear, editar o eliminar m√©todos) se subir√°n <strong>autom√°ticamente</strong> a la nube en tiempo real. Es la configuraci√≥n por defecto de producci√≥n.
            </p>
          </div>
        }
      </div>
    }
  </div>

</mat-dialog-content>

<mat-dialog-actions class="border-t border-gray-200 dark:border-gray-700 !p-4">
  @if (sincronizando) {
    <div class="flex items-center gap-3 w-full justify-center py-2">
      <mat-spinner diameter="30"></mat-spinner>
      <span class="text-sm text-gray-600 dark:text-gray-400">Sincronizando...</span>
    </div>
  } @else {
    <button 
      mat-raised-button 
      color="primary"
      type="button"
      (click)="guardar()"
      class="w-full flex items-center justify-center gap-2 h-12">
      <mat-icon>save</mat-icon>
      <span>Guardar Configuraci√≥n</span>
    </button>
  }
</mat-dialog-actions>

