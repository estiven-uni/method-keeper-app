<h2 mat-dialog-title class="flex items-center justify-between text-2xl font-bold text-gray-900 dark:text-gray-100">
  <div class="flex items-center gap-2">
    <mat-icon class="text-indigo-600 dark:text-indigo-400">settings</mat-icon>
    Configuración
  </div>
  <button mat-icon-button (click)="cancelar()">
    <mat-icon>close</mat-icon>
  </button>
</h2>

<mat-dialog-content class="mat-typography">
  <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">
    Configura tus preferencias de la aplicación
  </p>

  <!-- API Key de Deepseek -->
  <div class="mb-6">
    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2">
      <mat-icon class="text-purple-600 dark:text-purple-400">smart_toy</mat-icon>
      API Key de Deepseek
    </h3>
    <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">
      💡 Ingresa tu API Key de Deepseek para usar la función de generación con IA.
      Puedes obtener una en <a href="https://platform.deepseek.com/" target="_blank" class="text-indigo-600 dark:text-indigo-400 hover:underline">platform.deepseek.com</a>
    </p>

    <mat-form-field class="w-full" appearance="fill" subscriptSizing="dynamic">
      <mat-label>API Key</mat-label>
      <input 
        matInput 
        [(ngModel)]="apiKey"
        [type]="mostrarApiKey ? 'text' : 'password'"
        placeholder=""
        name="apiKey">
      <button 
        mat-icon-button 
        matSuffix 
        type="button"
        (click)="toggleMostrarApiKey()"
        [matTooltip]="mostrarApiKey ? 'Ocultar' : 'Mostrar'">
        <mat-icon>{{ mostrarApiKey ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
    </mat-form-field>

    @if (apiKey) {
      <button 
        mat-stroked-button 
        color="warn"
        type="button"
        (click)="eliminar()"
        class="mt-2 flex items-center justify-center">
        <mat-icon>delete</mat-icon>
        <span>Eliminar API Key</span>
      </button>
    }
  </div>

  <mat-divider class="mb-6"></mat-divider>

  <!-- Sincronización con JSONBin -->
  <div class="mb-6">
    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2">
      <mat-icon class="text-blue-600 dark:text-blue-400">cloud_sync</mat-icon>
      Sincronización en la Nube
    </h3>
    <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">
      💡 Conecta tu cuenta de <a href="https://jsonbin.io/" target="_blank" class="text-indigo-600 dark:text-indigo-400 hover:underline">JSONBin.io</a> para sincronizar tus métodos en la nube.
      <br>
      <strong>Plan Gratuito:</strong> 100,000 requests/mes
    </p>

    <!-- API Key de JSONBin -->
    <mat-form-field class="w-full mb-3" appearance="fill" subscriptSizing="dynamic">
      <mat-label>API Key de JSONBin</mat-label>
      <input 
        matInput 
        [(ngModel)]="jsonbinApiKey"
        [type]="mostrarJsonbinApiKey ? 'text' : 'password'"
        name="jsonbinApiKey">
      <button 
        mat-icon-button 
        matSuffix 
        type="button"
        (click)="toggleMostrarJsonbinApiKey()"
        [matTooltip]="mostrarJsonbinApiKey ? 'Ocultar' : 'Mostrar'">
        <mat-icon>{{ mostrarJsonbinApiKey ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
    </mat-form-field>

    <!-- Bin ID -->
    <mat-form-field class="w-full mb-3" appearance="fill" subscriptSizing="dynamic">
      <mat-label>Bin ID (opcional)</mat-label>
      <input 
        matInput 
        [(ngModel)]="jsonbinBinId"
        name="jsonbinBinId"
        matTooltip="Se generará automáticamente al subir por primera vez">
      <mat-icon matPrefix class="mr-2">tag</mat-icon>
      <mat-hint>Déjalo vacío si es tu primera vez</mat-hint>
    </mat-form-field>

    <div class="flex gap-2 mb-3">
      <button 
        mat-raised-button 
        color="primary"
        type="button"
        (click)="guardarJsonbin()"
        class="flex-1 flex items-center justify-center">
        <mat-icon>save</mat-icon>
        <span>Guardar Config.</span>
      </button>
      @if (jsonbinApiKey) {
        <button 
          mat-stroked-button 
          color="warn"
          type="button"
          (click)="eliminarJsonbin()"
          class="flex items-center justify-center">
          <mat-icon>delete</mat-icon>
        </button>
      }
    </div>

    <!-- Botones de Sincronización -->
    @if (jsonbinApiKey) {
      <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
        <h4 class="text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2">
          <mat-icon class="text-sm">sync</mat-icon>
          Opciones de Sincronización
        </h4>

        @if (sincronizando) {
          <div class="flex flex-col items-center justify-center py-4 gap-3">
            <mat-spinner diameter="40"></mat-spinner>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Sincronizando...
            </p>
          </div>
        } @else {
          <div class="grid grid-cols-1 gap-2">
            <!-- Subir a la nube -->
            <button 
              mat-raised-button 
              color="accent"
              type="button"
              (click)="subirANube()"
              class="flex items-center justify-center">
              <mat-icon>cloud_upload</mat-icon>
              <span>📤 Subir a la Nube</span>
            </button>

            <!-- Descargar de la nube -->
            <button 
              mat-stroked-button
              type="button"
              (click)="descargarDeNube()"
              [disabled]="!jsonbinBinId"
              class="flex items-center justify-center">
              <mat-icon>cloud_download</mat-icon>
              <span>📥 Descargar de la Nube</span>
            </button>

            <!-- Sincronización bidireccional -->
            <button 
              mat-raised-button 
              color="primary"
              type="button"
              (click)="sincronizarBidireccional()"
              [disabled]="!jsonbinBinId"
              class="flex items-center justify-center">
              <mat-icon>sync</mat-icon>
              <span>🔄 Sincronización Bidireccional</span>
            </button>
          </div>

          <div class="mt-3 text-xs text-gray-600 dark:text-gray-400">
            <p class="mb-1"><strong>📤 Subir:</strong> Envía tus métodos locales a la nube</p>
            <p class="mb-1"><strong>📥 Descargar:</strong> Reemplaza tus métodos locales con los de la nube</p>
            <p><strong>🔄 Bidireccional:</strong> Combina ambos sin perder datos (recomendado)</p>
          </div>
        }
      </div>
    }
  </div>

</mat-dialog-content>

<mat-dialog-actions align="end" class="border-t border-gray-200 dark:border-gray-700">
  <button 
    mat-stroked-button
    type="button"
    (click)="cancelar()"
    class="flex items-center justify-center">
    <mat-icon>close</mat-icon>
    <span>Cerrar</span>
  </button>
  <button 
    mat-raised-button 
    color="primary"
    type="button"
    (click)="guardar()"
    class="flex items-center justify-center">
    <mat-icon>save</mat-icon>
    <span>Guardar Deepseek</span>
  </button>
</mat-dialog-actions>

